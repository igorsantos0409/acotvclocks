<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <link id="theme-style" rel="stylesheet" href="style.css">
    <title>Relógios TV ACO</title>
</head>

<body>

<div class="top-bar">
    <div class="top-item" id="dateBox">--</div>
    <div class="top-item" id="weatherBox">Carregando...</div>
    <div class="top-item">
        <img src="aco-logo.svg" alt="Logo ACO" class="logo">
    </div>
</div>

<div id="clockContainer">

    <!-- Linha superior -->
    <div class="clock-row top-row">
        <div class="clock-container big animate" id="clock-ptContainer">
            <canvas id="clock-pt" width="260" height="260"></canvas>
            <div class="label">Portugal</div>
        </div>

        <div class="clock-container big animate" id="clock-esContainer">
            <canvas id="clock-es" width="260" height="260"></canvas>
            <div class="label">Espanha</div>
        </div>
    </div>

    <!-- Linha inferior -->
    <div class="clock-row bottom-row">
        <div class="clock-container small animate" id="clock-brContainer">
            <canvas id="clock-br" width="180" height="180"></canvas>
            <div class="label">Brasil</div>
        </div>

        <div class="clock-container small animate" id="clock-clContainer">
            <canvas id="clock-cl" width="180" height="180"></canvas>
            <div class="label">Chile</div>
        </div>

        <div class="clock-container small animate" id="clock-coContainer">
            <canvas id="clock-co" width="180" height="180"></canvas>
            <div class="label">Colombia</div>
        </div>

        <div class="clock-container small animate" id="clock-peContainer">
            <canvas id="clock-pe" width="180" height="180"></canvas>
            <div class="label">Perú</div>
        </div>

        <div class="clock-container small animate" id="clock-arContainer">
            <canvas id="clock-ar" width="180" height="180"></canvas>
            <div class="label">Argentina</div>
        </div>
    </div>

</div>

<h3 id="eta">ETA: carregando...</h3>

<script>
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('darkMode') === '1')
    document.getElementById("theme-style").href = "dark.css";

const isDigital = urlParams.get('digital') === '1';

const countries = [
    { id: 'clock-pt', tz: 'Europe/Lisbon', lb: 'Portugal' },
    { id: 'clock-es', tz: 'Europe/Madrid', lb: 'Espanha' },
    { id: 'clock-br', tz: 'America/Sao_Paulo', lb: 'Brasil' },
    { id: 'clock-cl', tz: 'America/Santiago', lb: 'Chile' },
    { id: 'clock-co', tz: 'America/Bogota', lb: 'Colombia' },
    { id: 'clock-pe', tz: 'America/Lima', lb: 'Perú' },
    { id: 'clock-ar', tz: 'America/Argentina/Buenos_Aires', lb: 'Argentina' }
];

function createAnalogClock(canvasId, timeZone) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");
    const r = canvas.height / 2;
    ctx.translate(r, r);

    function nowTZ() {
        return new Date(new Date().toLocaleString("en-US", { timeZone }));
    }

    function draw() {
        ctx.clearRect(-r, -r, canvas.width, canvas.height);
        face(); numbers(); time();
        requestAnimationFrame(draw);
    }

    function face() {
        ctx.beginPath();
        ctx.arc(0, 0, r * 0.95, 0, Math.PI * 2);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.lineWidth = 4;
        ctx.strokeStyle = "#aaa";
        ctx.stroke();
    }

    function numbers() {
        ctx.font = r * 0.14 + "px sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        for (let i = 1; i <= 12; i++) {
            const a = i * Math.PI / 6;
            ctx.rotate(a);
            ctx.translate(0, -r * 0.78);
            ctx.rotate(-a);
            ctx.fillText(i, 0, 0);
            ctx.rotate(a);
            ctx.translate(0, r * 0.78);
            ctx.rotate(-a);
        }
    }

    function time() {
        const d = nowTZ();
        const s = d.getSeconds() + d.getMilliseconds() / 1000;
        const m = d.getMinutes() + s / 60;
        const h = (d.getHours() % 12) + m / 60;
        hand(h * Math.PI / 6, r * 0.5, 6);
        hand(m * Math.PI / 30, r * 0.75, 4);
        hand(s * Math.PI / 30, r * 0.85, 2);
    }

    function hand(p, l, w) {
        ctx.beginPath();
        ctx.lineWidth = w;
        ctx.lineCap = "round";
        ctx.rotate(p);
        ctx.moveTo(0, 0);
        ctx.lineTo(0, -l);
        ctx.stroke();
        ctx.rotate(-p);
    }

    draw();
}

countries.forEach(c => {
    if (!isDigital) createAnalogClock(c.id, c.tz);
});
</script>

</body>
</html>
